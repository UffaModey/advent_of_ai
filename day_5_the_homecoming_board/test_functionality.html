<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Functionality Test - Interactive</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 2px solid rgba(245, 158, 11, 0.5); 
            border-radius: 15px; 
            background: rgba(255, 255, 255, 0.05);
        }
        .result { 
            background: rgba(255, 255, 255, 0.1); 
            padding: 15px; 
            margin: 15px 0; 
            border-radius: 10px; 
            border-left: 4px solid #6c757d;
            max-height: 300px;
            overflow-y: auto;
        }
        .error { 
            background: rgba(239, 68, 68, 0.2); 
            border-left-color: #ef4444;
        }
        .success { 
            background: rgba(34, 197, 94, 0.2); 
            border-left-color: #22c55e;
        }
        .loading { 
            background: rgba(245, 158, 11, 0.2); 
            border-left-color: #f59e0b;
        }
        button { 
            padding: 12px 20px; 
            margin: 8px; 
            background: #f59e0b; 
            color: #1e3a8a; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        button:hover { 
            background: #fbbf24; 
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
        }
        button:disabled { 
            background: #6c757d; 
            cursor: not-allowed; 
            transform: none;
            box-shadow: none;
        }
        select { 
            padding: 10px; 
            margin: 8px; 
            width: 100%; 
            max-width: 400px; 
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        h1 { 
            color: #f59e0b; 
            text-align: center; 
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        h2 { 
            color: #fbbf24; 
            border-bottom: 2px solid #f59e0b; 
            padding-bottom: 8px; 
            font-size: 1.4rem;
        }
        .airport-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .airport-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .airport-item:hover {
            background: rgba(245, 158, 11, 0.2);
            border-color: #f59e0b;
        }
        .airport-item.selected {
            background: rgba(245, 158, 11, 0.3);
            border-color: #f59e0b;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }
        .flight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        .flight-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ´ Interactive Flight App Test</h1>
        
        <div class="test-section">
            <h2>üéØ Current App Status</h2>
            <button onclick="checkCurrentStatus()">üîç Check Status</button>
            <div id="status-display" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>üè¢ Airport Selection Test</h2>
            <button onclick="loadAirportList()">üìã Load All Airports</button>
            <div id="airport-status" class="result"></div>
            
            <select id="airport-selector" onchange="selectAirport()">
                <option value="">Choose an airport...</option>
            </select>
            
            <div id="airport-list-display" class="airport-list"></div>
        </div>
        
        <div class="test-section">
            <h2>‚úàÔ∏è Flight Data Test</h2>
            <button onclick="testFlightData()" id="flight-test-btn" disabled>üõ¨ Test Selected Airport</button>
            <div id="flight-status" class="result"></div>
            
            <div id="flight-data-display" class="flight-grid"></div>
        </div>
        
        <div class="test-section">
            <h2>üéÆ Navigation Test</h2>
            <button onclick="testNavigation()">üñêÔ∏è Test Gesture Navigation</button>
            <div id="navigation-status" class="result"></div>
        </div>
    </div>

    <!-- Load necessary scripts -->
    <script src="js/utils/cache.js"></script>
    <script src="js/utils/api.js"></script>
    
    <script>
        let flightAPI;
        let availableAirports = [];
        let selectedAirportCode = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            flightAPI = window.FlightAPI;
            console.log('üöÄ Test app loaded');
            
            // Auto-check status
            setTimeout(checkCurrentStatus, 500);
            setTimeout(loadAirportList, 1000);
        });
        
        async function checkCurrentStatus() {
            const statusDiv = document.getElementById('status-display');
            
            try {
                statusDiv.innerHTML = `
                    <div style="font-size: 16px; line-height: 1.6;">
                        <strong>üîç API Status Check:</strong><br><br>
                        ‚úÖ FlightAPI: ${flightAPI ? 'Loaded' : 'Not Loaded'}<br>
                        ‚úÖ Cache System: ${window.FlightCache ? 'Available' : 'Not Available'}<br>
                        ‚úÖ Airports Loaded: ${flightAPI.airportsLoaded ? 'Yes' : 'No'}<br>
                        ‚úÖ Airports in Memory: ${flightAPI.airports.length}<br>
                        ‚úÖ Base URL: ${flightAPI.baseURL}<br>
                        ‚úÖ API Key: ${flightAPI.apiKey ? 'Set' : 'Missing'}
                    </div>
                `;
                statusDiv.className = 'result success';
                
            } catch (error) {
                statusDiv.innerHTML = `‚ùå Status check failed: ${error.message}`;
                statusDiv.className = 'result error';
            }
        }
        
        async function loadAirportList() {
            const statusDiv = document.getElementById('airport-status');
            const selectorDiv = document.getElementById('airport-selector');
            const listDiv = document.getElementById('airport-list-display');
            
            try {
                statusDiv.innerHTML = '‚è≥ Loading airports from API...';
                statusDiv.className = 'result loading';
                
                const airports = await flightAPI.getAvailableAirports();
                availableAirports = airports;
                
                console.log('‚úÖ Airports loaded:', airports);
                
                if (airports && airports.length > 0) {
                    statusDiv.innerHTML = `
                        <strong>‚úÖ Airport Loading Success!</strong><br>
                        üìç Total airports: ${airports.length}<br>
                        üåç Countries represented: ${new Set(airports.map(a => a.country)).size}<br>
                        üèôÔ∏è Cities represented: ${new Set(airports.map(a => a.city)).size}
                    `;
                    statusDiv.className = 'result success';
                    
                    // Populate selector
                    selectorDiv.innerHTML = '<option value="">Choose an airport...</option>';
                    airports.forEach(airport => {
                        const option = document.createElement('option');
                        option.value = airport.code;
                        option.textContent = `${airport.code} - ${airport.name} (${airport.city})`;
                        selectorDiv.appendChild(option);
                    });
                    
                    // Show airport list for visual scrolling test
                    listDiv.innerHTML = '';
                    airports.slice(0, 10).forEach(airport => {
                        const item = document.createElement('div');
                        item.className = 'airport-item';
                        item.innerHTML = `
                            <strong>${airport.code}</strong><br>
                            <small>${airport.name}</small><br>
                            <small>${airport.location}</small>
                        `;
                        item.onclick = () => selectSpecificAirport(airport.code);
                        listDiv.appendChild(item);
                    });
                    
                    if (airports.length > 10) {
                        const moreItem = document.createElement('div');
                        moreItem.className = 'airport-item';
                        moreItem.innerHTML = `<em>... and ${airports.length - 10} more airports</em>`;
                        moreItem.style.opacity = '0.7';
                        listDiv.appendChild(moreItem);
                    }
                    
                } else {
                    statusDiv.innerHTML = '‚ùå No airports loaded';
                    statusDiv.className = 'result error';
                }
                
            } catch (error) {
                console.error('Airport loading failed:', error);
                statusDiv.innerHTML = `‚ùå Error loading airports: ${error.message}`;
                statusDiv.className = 'result error';
            }
        }
        
        function selectAirport() {
            const selector = document.getElementById('airport-selector');
            selectedAirportCode = selector.value;
            
            const testBtn = document.getElementById('flight-test-btn');
            
            if (selectedAirportCode) {
                testBtn.disabled = false;
                testBtn.textContent = `üõ¨ Test ${selectedAirportCode} Flights`;
                
                // Highlight selected airport in list
                document.querySelectorAll('.airport-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                console.log(`‚úàÔ∏è Selected airport: ${selectedAirportCode}`);
            } else {
                testBtn.disabled = true;
                testBtn.textContent = 'üõ¨ Test Selected Airport';
            }
        }
        
        function selectSpecificAirport(airportCode) {
            const selector = document.getElementById('airport-selector');
            selector.value = airportCode;
            selectAirport();
            
            // Visual feedback
            document.querySelectorAll('.airport-item').forEach(item => {
                item.classList.remove('selected');
                if (item.textContent.includes(airportCode)) {
                    item.classList.add('selected');
                }
            });
        }
        
        async function testFlightData() {
            if (!selectedAirportCode) return;
            
            const statusDiv = document.getElementById('flight-status');
            const dataDiv = document.getElementById('flight-data-display');
            
            try {
                statusDiv.innerHTML = `‚è≥ Loading flight data for ${selectedAirportCode}...`;
                statusDiv.className = 'result loading';
                
                // Test both arrivals and departures
                const [arrivals, departures] = await Promise.all([
                    flightAPI.getArrivals(selectedAirportCode),
                    flightAPI.getDepartures(selectedAirportCode)
                ]);
                
                console.log('Flight data loaded:', { arrivals, departures });
                
                statusDiv.innerHTML = `
                    <strong>‚úÖ Flight Data Success!</strong><br>
                    üõ¨ Arrivals: ${arrivals.length} flights<br>
                    üõ´ Departures: ${departures.length} flights<br>
                    üìä Total: ${arrivals.length + departures.length} flights
                `;
                statusDiv.className = 'result success';
                
                // Display flight data
                dataDiv.innerHTML = '';
                
                // Show sample arrivals
                if (arrivals.length > 0) {
                    const arrivalsHeader = document.createElement('h3');
                    arrivalsHeader.textContent = `üõ¨ Sample Arrivals (${Math.min(3, arrivals.length)} of ${arrivals.length})`;
                    arrivalsHeader.style.gridColumn = '1 / -1';
                    arrivalsHeader.style.color = '#22c55e';
                    dataDiv.appendChild(arrivalsHeader);
                    
                    arrivals.slice(0, 3).forEach(flight => {
                        const item = document.createElement('div');
                        item.className = 'flight-item';
                        item.innerHTML = `
                            <strong>${flight.flightNumber}</strong> - ${flight.airline}<br>
                            <small>From: ${flight.origin.code} (${flight.origin.name})</small><br>
                            <small>Status: ${flight.status.display}</small><br>
                            <small>Time: ${new Date(flight.scheduledTime).toLocaleTimeString()}</small>
                        `;
                        dataDiv.appendChild(item);
                    });
                }
                
                // Show sample departures
                if (departures.length > 0) {
                    const departuresHeader = document.createElement('h3');
                    departuresHeader.textContent = `üõ´ Sample Departures (${Math.min(3, departures.length)} of ${departures.length})`;
                    departuresHeader.style.gridColumn = '1 / -1';
                    departuresHeader.style.color = '#f59e0b';
                    dataDiv.appendChild(departuresHeader);
                    
                    departures.slice(0, 3).forEach(flight => {
                        const item = document.createElement('div');
                        item.className = 'flight-item';
                        item.innerHTML = `
                            <strong>${flight.flightNumber}</strong> - ${flight.airline}<br>
                            <small>To: ${flight.destination.code} (${flight.destination.name})</small><br>
                            <small>Status: ${flight.status.display}</small><br>
                            <small>Time: ${new Date(flight.scheduledTime).toLocaleTimeString()}</small>
                        `;
                        dataDiv.appendChild(item);
                    });
                }
                
            } catch (error) {
                console.error('Flight test failed:', error);
                statusDiv.innerHTML = `‚ùå Flight data test failed: ${error.message}`;
                statusDiv.className = 'result error';
            }
        }
        
        function testNavigation() {
            const statusDiv = document.getElementById('navigation-status');
            
            let result = `
                <strong>üéÆ Navigation & Scrolling Features:</strong><br><br>
                
                <strong>‚úÖ Airport List Navigation:</strong><br>
                ‚Ä¢ Wave Hand (üñêÔ∏è) gesture scrolls through airport list<br>
                ‚Ä¢ Circular navigation (last ‚ûú first, first ‚ûú last)<br>
                ‚Ä¢ Visual selection with gold highlighting<br>
                ‚Ä¢ Smooth scroll into view<br><br>
                
                <strong>‚úÖ Flight List Navigation:</strong><br>
                ‚Ä¢ Wave Hand (üñêÔ∏è) gesture scrolls through flights<br>
                ‚Ä¢ Works for both arrivals and departures<br>
                ‚Ä¢ Visual selection with card highlighting<br>
                ‚Ä¢ Auto-scroll to selected item<br><br>
                
                <strong>‚úÖ Gesture Controls Available:</strong><br>
                ü§ô Shaka ‚ûú Load Arrivals<br>
                üëå OK Sign ‚ûú Load Departures<br>
                üñêÔ∏è Wave Hand ‚ûú Navigate Lists<br>
                ‚úä Closed Fist ‚ûú Select Flight<br>
                üññ Vulcan Sign ‚ûú Back/Exit<br>
                ‚úåÔ∏è Peace Sign ‚ûú Refresh Data<br>
                ü§ò Rock Sign ‚ûú Switch Airport<br><br>
                
                <strong>‚úÖ Scrolling Implementation:</strong><br>
                ‚Ä¢ Airport list: max-height 400px, overflow-y auto<br>
                ‚Ä¢ Flight list: CSS Grid with proper overflow<br>
                ‚Ä¢ Custom scrollbars with winter theme<br>
                ‚Ä¢ Smooth scrolling behavior
            `;
            
            statusDiv.innerHTML = result;
            statusDiv.className = 'result success';
        }
        
        // Test specific gesture actions
        function simulateGesture(gestureName) {
            console.log(`üé≠ Simulating gesture: ${gestureName}`);
            
            // This would normally trigger the actual gesture action
            // For testing, we'll just show what would happen
            const gestureActions = {
                'shaka': 'Load Arrivals - Switch to arrivals tab and load arrival flights',
                'ok_sign': 'Load Departures - Switch to departures tab and load departure flights', 
                'wave_hand': 'Navigate Lists - Scroll through current list (airports or flights)',
                'closed_fist': 'Select Flight - Choose highlighted flight for details',
                'vulcan_sign': 'Back/Exit - Return to main screen from detail view',
                'peace_sign': 'Refresh Data - Clear cache and reload current data',
                'rock_on_sign': 'Switch Airport - Toggle airport selection screen'
            };
            
            const action = gestureActions[gestureName];
            if (action) {
                alert(`Gesture Action: ${action}`);
            }
        }
    </script>
</body>
</html>
