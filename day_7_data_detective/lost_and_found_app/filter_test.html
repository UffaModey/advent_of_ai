<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter Test - Lost & Found Detective</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .controls { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .item { border: 1px solid #ccc; padding: 10px; margin: 5px 0; border-radius: 5px; }
        .item.high { border-left: 5px solid red; }
        .item.medium { border-left: 5px solid orange; }
        .item.low { border-left: 5px solid green; }
        select, input { margin: 5px; padding: 5px; }
        button { padding: 8px 15px; margin: 5px; cursor: pointer; }
        #status { font-weight: bold; margin: 10px 0; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>üîç Filter Test Page</h1>
    
    <div class="controls">
        <h2>Test Controls</h2>
        <div>
            <label>Category: 
                <select id="categoryTest">
                    <option value="">All Categories</option>
                </select>
            </label>
            
            <label>Urgency: 
                <select id="urgencyTest">
                    <option value="">All Urgencies</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
            </label>
            
            <label>Location: 
                <select id="locationTest">
                    <option value="">All Locations</option>
                </select>
            </label>
            
            <label>Search: 
                <input type="text" id="searchTest" placeholder="Type to search...">
            </label>
            
            <button onclick="testFilters()">Apply Filters</button>
            <button onclick="clearFilters()">Clear All</button>
        </div>
        
        <div id="status">Status: Loading...</div>
    </div>
    
    <div id="itemsDisplay">
        <h2>Items (<span id="itemCount">0</span>)</h2>
        <div id="itemsList"></div>
    </div>

    <script>
        let allItems = [];
        let filteredItems = [];
        
        async function loadData() {
            try {
                const response = await fetch('data.json');
                const data = await response.json();
                allItems = data.items || [];
                filteredItems = [...allItems];
                
                updateStatus(`‚úÖ Loaded ${allItems.length} items successfully`);
                
                // Populate filter options
                const categories = [...new Set(allItems.map(item => item.category))].sort();
                const categorySelect = document.getElementById('categoryTest');
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });
                
                const locations = [...new Set(allItems.map(item => item.location))]
                    .filter(location => location && location !== 'Unknown').sort();
                const locationSelect = document.getElementById('locationTest');
                locations.forEach(location => {
                    const option = document.createElement('option');
                    option.value = location;
                    option.textContent = location;
                    locationSelect.appendChild(option);
                });
                
                displayItems();
                
            } catch (error) {
                updateStatus(`‚ùå Error loading data: ${error.message}`);
            }
        }
        
        function updateStatus(message) {
            document.getElementById('status').textContent = `Status: ${message}`;
        }
        
        function testFilters() {
            const categoryValue = document.getElementById('categoryTest').value;
            const urgencyValue = document.getElementById('urgencyTest').value;
            const locationValue = document.getElementById('locationTest').value;
            const searchValue = document.getElementById('searchTest').value.toLowerCase().trim();
            
            console.log('üîç Applying filters:', {
                category: categoryValue,
                urgency: urgencyValue,
                location: locationValue,
                search: searchValue
            });
            
            filteredItems = allItems.filter(item => {
                // Category filter
                if (categoryValue && item.category !== categoryValue) {
                    return false;
                }
                
                // Urgency filter
                if (urgencyValue && item.urgency !== urgencyValue) {
                    return false;
                }
                
                // Location filter
                if (locationValue && item.location !== locationValue) {
                    return false;
                }
                
                // Search filter
                if (searchValue) {
                    const searchableText = [
                        item.item,
                        item.description,
                        item.category,
                        item.location,
                        item.original_entry
                    ].join(' ').toLowerCase();
                    
                    if (!searchableText.includes(searchValue)) {
                        return false;
                    }
                }
                
                return true;
            });
            
            updateStatus(`üîç Filtered to ${filteredItems.length} of ${allItems.length} items`);
            displayItems();
        }
        
        function clearFilters() {
            document.getElementById('categoryTest').value = '';
            document.getElementById('urgencyTest').value = '';
            document.getElementById('locationTest').value = '';
            document.getElementById('searchTest').value = '';
            filteredItems = [...allItems];
            updateStatus(`üßπ Cleared filters - showing all ${allItems.length} items`);
            displayItems();
        }
        
        function displayItems() {
            const itemsList = document.getElementById('itemsList');
            const itemCount = document.getElementById('itemCount');
            
            itemCount.textContent = filteredItems.length;
            
            if (filteredItems.length === 0) {
                itemsList.innerHTML = '<p>No items match the current filters.</p>';
                return;
            }
            
            // Show first 10 items to avoid overwhelming the page
            const itemsToShow = filteredItems.slice(0, 10);
            
            itemsList.innerHTML = itemsToShow.map(item => `
                <div class="item ${item.urgency}">
                    <strong>${getCategoryIcon(item.category)} ${item.item}</strong>
                    <br><small>Category: ${item.category} | Urgency: ${item.urgency} | Location: ${item.location}</small>
                    <br><em>${item.description}</em>
                </div>
            `).join('');
            
            if (filteredItems.length > 10) {
                itemsList.innerHTML += `<p><em>... and ${filteredItems.length - 10} more items</em></p>`;
            }
        }
        
        function getCategoryIcon(category) {
            const icons = {
                'Electronics': 'üì±',
                'Clothing': 'üëï',
                'Keys & Wallets': 'üîë',
                'Accessories': 'üëì',
                'Personal Items': 'üìö',
                'Other': 'üì¶'
            };
            return icons[category] || 'üì¶';
        }
        
        // Auto-apply filters as user types
        document.getElementById('searchTest').addEventListener('input', testFilters);
        document.getElementById('categoryTest').addEventListener('change', testFilters);
        document.getElementById('urgencyTest').addEventListener('change', testFilters);
        document.getElementById('locationTest').addEventListener('change', testFilters);
        
        // Load data when page loads
        loadData();
    </script>
</body>
</html>
